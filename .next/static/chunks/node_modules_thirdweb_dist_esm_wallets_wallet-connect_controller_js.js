"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunk_N_E"] = self["webpackChunk_N_E"] || []).push([["node_modules_thirdweb_dist_esm_wallets_wallet-connect_controller_js"],{

/***/ "./node_modules/thirdweb/dist/esm/wallets/wallet-connect/controller.js":
/*!*****************************************************************************!*\
  !*** ./node_modules/thirdweb/dist/esm/wallets/wallet-connect/controller.js ***!
  \*****************************************************************************/
/***/ (function(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   autoConnectWC: function() { return /* binding */ autoConnectWC; },\n/* harmony export */   connectWC: function() { return /* binding */ connectWC; },\n/* harmony export */   isWalletConnect: function() { return /* binding */ isWalletConnect; }\n/* harmony export */ });\n/* harmony import */ var viem__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! viem */ \"./node_modules/viem/_esm/index.js\");\n/* harmony import */ var _analytics_track_transaction_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../analytics/track/transaction.js */ \"./node_modules/thirdweb/dist/esm/analytics/track/transaction.js\");\n/* harmony import */ var _chains_utils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../chains/utils.js */ \"./node_modules/thirdweb/dist/esm/chains/utils.js\");\n/* harmony import */ var _utils_address_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../utils/address.js */ \"./node_modules/thirdweb/dist/esm/utils/address.js\");\n/* harmony import */ var _utils_encoding_hex_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../utils/encoding/hex.js */ \"./node_modules/thirdweb/dist/esm/utils/encoding/hex.js\");\n/* harmony import */ var _utils_json_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../utils/json.js */ \"./node_modules/thirdweb/dist/esm/utils/json.js\");\n/* harmony import */ var _utils_signatures_helpers_parse_typed_data_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../utils/signatures/helpers/parse-typed-data.js */ \"./node_modules/thirdweb/dist/esm/utils/signatures/helpers/parse-typed-data.js\");\n/* harmony import */ var _utils_storage_walletStorage_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../utils/storage/walletStorage.js */ \"./node_modules/thirdweb/dist/esm/utils/storage/walletStorage.js\");\n/* harmony import */ var _utils_url_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/url.js */ \"./node_modules/thirdweb/dist/esm/utils/url.js\");\n/* harmony import */ var _generated_getWalletInfo_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../__generated__/getWalletInfo.js */ \"./node_modules/thirdweb/dist/esm/wallets/__generated__/getWalletInfo.js\");\n/* harmony import */ var _utils_defaultDappMetadata_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../utils/defaultDappMetadata.js */ \"./node_modules/thirdweb/dist/esm/wallets/utils/defaultDappMetadata.js\");\n/* harmony import */ var _utils_normalizeChainId_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/normalizeChainId.js */ \"./node_modules/thirdweb/dist/esm/wallets/utils/normalizeChainId.js\");\n/* harmony import */ var _constants_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./constants.js */ \"./node_modules/thirdweb/dist/esm/wallets/wallet-connect/constants.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\nlet cachedProvider = null;\nconst storageKeys = {\n    lastUsedChainId: \"tw.wc.lastUsedChainId\",\n    requestedChains: \"tw.wc.requestedChains\",\n};\n/**\n * Checks if the provided wallet is a Wallet Connect wallet.\n *\n * @param wallet - The wallet to check.\n * @returns True if the wallet is a Wallet Connect wallet, false otherwise.\n */\nfunction isWalletConnect(wallet) {\n    return wallet.id === \"walletConnect\";\n}\n/**\n * @internal\n */\nasync function connectWC(options, emitter, walletId, storage, sessionHandler) {\n    const provider = await initProvider(options, walletId, sessionHandler);\n    const wcOptions = options.walletConnect;\n    let { onDisplayUri } = wcOptions || {};\n    const walletInfo = await (0,_generated_getWalletInfo_js__WEBPACK_IMPORTED_MODULE_0__.getWalletInfo)(walletId);\n    // use default sessionHandler unless onDisplayUri is explicitly provided\n    if (!onDisplayUri && sessionHandler) {\n        const deeplinkHandler = (uri) => {\n            const appUrl = walletInfo.mobile.native || walletInfo.mobile.universal;\n            if (!appUrl) {\n                // generic wc uri\n                sessionHandler(uri);\n                return;\n            }\n            const fullUrl = (0,_utils_url_js__WEBPACK_IMPORTED_MODULE_1__.formatWalletConnectUrl)(appUrl, uri).redirect;\n            sessionHandler(fullUrl);\n        };\n        onDisplayUri = deeplinkHandler;\n    }\n    if (onDisplayUri) {\n        provider.events.addListener(\"display_uri\", onDisplayUri);\n    }\n    let optionalChains = wcOptions?.optionalChains;\n    let chainToRequest = options.chain;\n    // ignore the given options chains - and set the safe supported chains\n    if (walletId === \"global.safe\") {\n        optionalChains = chainsToRequestForSafe.map(_chains_utils_js__WEBPACK_IMPORTED_MODULE_2__.getCachedChain);\n        if (chainToRequest && !optionalChains.includes(chainToRequest)) {\n            chainToRequest = undefined;\n        }\n    }\n    // For UniversalProvider, we still need chain configuration for session management\n    const { chains: chainsToRequest, rpcMap } = getChainsToRequest({\n        chain: chainToRequest,\n        client: options.client,\n        optionalChains: optionalChains,\n    });\n    // For UniversalProvider, we need to connect with namespaces\n    await provider.connect({\n        ...(wcOptions?.pairingTopic\n            ? { pairingTopic: wcOptions?.pairingTopic }\n            : {}),\n        namespaces: {\n            [_constants_js__WEBPACK_IMPORTED_MODULE_3__.NAMESPACE]: {\n                chains: chainsToRequest,\n                events: [\"chainChanged\", \"accountsChanged\"],\n                methods: [\n                    \"eth_sendTransaction\",\n                    \"eth_signTransaction\",\n                    \"eth_sign\",\n                    \"personal_sign\",\n                    \"eth_signTypedData\",\n                    \"wallet_switchEthereumChain\",\n                    \"wallet_addEthereumChain\",\n                ],\n                rpcMap,\n            },\n        },\n    });\n    setRequestedChainsIds(chainsToRequest.map((x) => Number(x.split(\":\")[1])), storage);\n    const currentChainId = chainsToRequest[0]?.split(\":\")[1] || 1;\n    const providerChainId = (0,_utils_normalizeChainId_js__WEBPACK_IMPORTED_MODULE_4__.normalizeChainId)(currentChainId);\n    const accounts = await provider.request({\n        method: \"eth_requestAccounts\",\n        params: [],\n    }, `eip155:${providerChainId}`);\n    const address = accounts[0];\n    if (!address) {\n        throw new Error(\"No accounts found on provider.\");\n    }\n    const chain = options.chain && options.chain.id === providerChainId\n        ? options.chain\n        : (0,_chains_utils_js__WEBPACK_IMPORTED_MODULE_2__.getCachedChain)(providerChainId);\n    if (options) {\n        const savedParams = {\n            chain: options.chain,\n            optionalChains: options.walletConnect?.optionalChains,\n            pairingTopic: options.walletConnect?.pairingTopic,\n        };\n        if (storage) {\n            (0,_utils_storage_walletStorage_js__WEBPACK_IMPORTED_MODULE_5__.saveConnectParamsToStorage)(storage, walletId, savedParams);\n        }\n    }\n    if (wcOptions?.onDisplayUri) {\n        provider.events.removeListener(\"display_uri\", wcOptions.onDisplayUri);\n    }\n    return onConnect(address, chain, provider, emitter, storage, options.client, walletInfo, sessionHandler);\n}\n/**\n * Auto connect to already connected wallet connect session.\n * @internal\n */\nasync function autoConnectWC(options, emitter, walletId, storage, sessionHandler) {\n    const savedConnectParams = storage\n        ? await (0,_utils_storage_walletStorage_js__WEBPACK_IMPORTED_MODULE_5__.getSavedConnectParamsFromStorage)(storage, walletId)\n        : null;\n    const walletInfo = await (0,_generated_getWalletInfo_js__WEBPACK_IMPORTED_MODULE_0__.getWalletInfo)(walletId);\n    const provider = await initProvider(savedConnectParams\n        ? {\n            chain: savedConnectParams.chain,\n            client: options.client,\n            walletConnect: {\n                optionalChains: savedConnectParams.optionalChains,\n                pairingTopic: savedConnectParams.pairingTopic,\n            },\n        }\n        : {\n            client: options.client,\n            walletConnect: {},\n        }, walletId, sessionHandler);\n    if (!provider.session) {\n        await provider.disconnect();\n        throw new Error(\"No wallet connect session found on provider.\");\n    }\n    // For UniversalProvider, get accounts from enable() method\n    const namespaceAccounts = provider.session?.namespaces?.[_constants_js__WEBPACK_IMPORTED_MODULE_3__.NAMESPACE]?.accounts;\n    const address = namespaceAccounts?.[0]?.split(\":\")[2];\n    if (!address) {\n        throw new Error(\"No accounts found on provider.\");\n    }\n    // For UniversalProvider, get chainId from the session namespaces or use default\n    const currentChainId = options.chain?.id || 1;\n    const providerChainId = (0,_utils_normalizeChainId_js__WEBPACK_IMPORTED_MODULE_4__.normalizeChainId)(currentChainId);\n    const chain = options.chain && options.chain.id === providerChainId\n        ? options.chain\n        : (0,_chains_utils_js__WEBPACK_IMPORTED_MODULE_2__.getCachedChain)(providerChainId);\n    return onConnect(address, chain, provider, emitter, storage, options.client, walletInfo, sessionHandler);\n}\n// Connection utils -----------------------------------------------------------------------------------------------\nasync function initProvider(options, walletId, sessionRequestHandler) {\n    if (cachedProvider) {\n        return cachedProvider;\n    }\n    const walletInfo = await (0,_generated_getWalletInfo_js__WEBPACK_IMPORTED_MODULE_0__.getWalletInfo)(walletId);\n    const wcOptions = options.walletConnect;\n    const { UniversalProvider } = await __webpack_require__.e(/*! import() */ \"node_modules_walletconnect_universal-provider_dist_index_es_js\").then(__webpack_require__.bind(__webpack_require__, /*! @walletconnect/universal-provider */ \"./node_modules/@walletconnect/universal-provider/dist/index.es.js\"));\n    let optionalChains = wcOptions?.optionalChains;\n    let chainToRequest = options.chain;\n    // ignore the given options chains - and set the safe supported chains\n    if (walletId === \"global.safe\") {\n        optionalChains = chainsToRequestForSafe.map(_chains_utils_js__WEBPACK_IMPORTED_MODULE_2__.getCachedChain);\n        if (chainToRequest && !optionalChains.includes(chainToRequest)) {\n            chainToRequest = undefined;\n        }\n    }\n    const provider = await UniversalProvider.init({\n        metadata: {\n            description: wcOptions?.appMetadata?.description ||\n                (0,_utils_defaultDappMetadata_js__WEBPACK_IMPORTED_MODULE_6__.getDefaultAppMetadata)().description,\n            icons: [\n                wcOptions?.appMetadata?.logoUrl || (0,_utils_defaultDappMetadata_js__WEBPACK_IMPORTED_MODULE_6__.getDefaultAppMetadata)().logoUrl,\n            ],\n            name: wcOptions?.appMetadata?.name || (0,_utils_defaultDappMetadata_js__WEBPACK_IMPORTED_MODULE_6__.getDefaultAppMetadata)().name,\n            url: wcOptions?.appMetadata?.url || (0,_utils_defaultDappMetadata_js__WEBPACK_IMPORTED_MODULE_6__.getDefaultAppMetadata)().url,\n            redirect: {\n                native: walletInfo.mobile.native || undefined,\n                universal: walletInfo.mobile.universal || undefined,\n            },\n        },\n        projectId: wcOptions?.projectId || _constants_js__WEBPACK_IMPORTED_MODULE_3__.DEFAULT_PROJECT_ID,\n    });\n    provider.events.setMaxListeners(Number.POSITIVE_INFINITY);\n    if (walletId !== \"walletConnect\") {\n        async function handleSessionRequest() {\n            const walletLinkToOpen = provider.session?.peer?.metadata?.redirect?.native ||\n                walletInfo.mobile.native ||\n                walletInfo.mobile.universal;\n            if (sessionRequestHandler && walletLinkToOpen) {\n                // TODO: propagate error when this fails\n                await sessionRequestHandler(walletLinkToOpen);\n            }\n        }\n        // For UniversalProvider, use different event handling\n        provider.on(\"session_request_sent\", handleSessionRequest);\n        provider.events.addListener(\"disconnect\", () => {\n            provider.off(\"session_request_sent\", handleSessionRequest);\n            cachedProvider = null;\n        });\n    }\n    cachedProvider = provider;\n    return provider;\n}\nfunction createAccount({ provider, address, client, chain, sessionRequestHandler, walletInfo, }) {\n    const account = {\n        address: (0,_utils_address_js__WEBPACK_IMPORTED_MODULE_7__.getAddress)(address),\n        async sendTransaction(tx) {\n            const transactionHash = (await requestAndOpenWallet({\n                provider,\n                payload: {\n                    method: \"eth_sendTransaction\",\n                    params: [\n                        {\n                            data: tx.data,\n                            from: (0,_utils_address_js__WEBPACK_IMPORTED_MODULE_7__.getAddress)(address),\n                            gas: tx.gas ? (0,_utils_encoding_hex_js__WEBPACK_IMPORTED_MODULE_8__.numberToHex)(tx.gas) : undefined,\n                            to: tx.to,\n                            value: tx.value ? (0,_utils_encoding_hex_js__WEBPACK_IMPORTED_MODULE_8__.numberToHex)(tx.value) : undefined,\n                        },\n                    ],\n                },\n                chain: `eip155:${tx.chainId}`,\n                walletInfo,\n                sessionRequestHandler,\n            }));\n            (0,_analytics_track_transaction_js__WEBPACK_IMPORTED_MODULE_9__.trackTransaction)({\n                chainId: tx.chainId,\n                client: client,\n                contractAddress: tx.to ?? undefined,\n                gasPrice: tx.gasPrice,\n                transactionHash,\n                walletAddress: (0,_utils_address_js__WEBPACK_IMPORTED_MODULE_7__.getAddress)(address),\n                walletType: \"walletConnect\",\n            });\n            return {\n                transactionHash,\n            };\n        },\n        async signMessage({ message }) {\n            const messageToSign = (() => {\n                if (typeof message === \"string\") {\n                    return (0,_utils_encoding_hex_js__WEBPACK_IMPORTED_MODULE_8__.stringToHex)(message);\n                }\n                if (message.raw instanceof Uint8Array) {\n                    return (0,_utils_encoding_hex_js__WEBPACK_IMPORTED_MODULE_8__.uint8ArrayToHex)(message.raw);\n                }\n                return message.raw;\n            })();\n            return requestAndOpenWallet({\n                provider,\n                payload: {\n                    method: \"personal_sign\",\n                    params: [messageToSign, this.address],\n                },\n                chain: `eip155:${chain.id}`,\n                walletInfo,\n                sessionRequestHandler,\n            });\n        },\n        async signTypedData(_data) {\n            const data = (0,_utils_signatures_helpers_parse_typed_data_js__WEBPACK_IMPORTED_MODULE_10__.parseTypedData)(_data);\n            const { domain, message, primaryType } = data;\n            const types = {\n                EIP712Domain: (0,viem__WEBPACK_IMPORTED_MODULE_11__.getTypesForEIP712Domain)({ domain }),\n                ...data.types,\n            };\n            // Need to do a runtime validation check on addresses, byte ranges, integer ranges, etc\n            // as we can't statically check this with TypeScript.\n            (0,viem__WEBPACK_IMPORTED_MODULE_11__.validateTypedData)({ domain, message, primaryType, types });\n            const typedData = (0,viem__WEBPACK_IMPORTED_MODULE_11__.serializeTypedData)({\n                domain: domain ?? {},\n                message,\n                primaryType,\n                types,\n            });\n            return await requestAndOpenWallet({\n                provider,\n                payload: {\n                    method: \"eth_signTypedData_v4\",\n                    params: [this.address, typedData],\n                },\n                chain: `eip155:${chain.id}`,\n                walletInfo,\n                sessionRequestHandler,\n            });\n        },\n    };\n    return account;\n}\nasync function requestAndOpenWallet(args) {\n    const { provider, payload, chain, walletInfo, sessionRequestHandler } = args;\n    const resultPromise = provider.request(payload, chain);\n    const walletLinkToOpen = provider.session?.peer?.metadata?.redirect?.native ||\n        walletInfo.mobile.native ||\n        walletInfo.mobile.universal;\n    if (sessionRequestHandler && walletLinkToOpen) {\n        await sessionRequestHandler(walletLinkToOpen);\n    }\n    return resultPromise;\n}\nfunction onConnect(address, chain, provider, emitter, storage, client, walletInfo, sessionRequestHandler) {\n    const account = createAccount({\n        address,\n        chain,\n        client,\n        provider,\n        sessionRequestHandler,\n        walletInfo,\n    });\n    async function disconnect() {\n        provider.removeListener(\"accountsChanged\", onAccountsChanged);\n        provider.removeListener(\"chainChanged\", onChainChanged);\n        provider.removeListener(\"disconnect\", onDisconnect);\n        await provider.disconnect();\n        cachedProvider = null;\n    }\n    function onDisconnect() {\n        setRequestedChainsIds([], storage);\n        storage?.removeItem(storageKeys.lastUsedChainId);\n        disconnect();\n        emitter.emit(\"disconnect\", undefined);\n    }\n    function onAccountsChanged(accounts) {\n        if (accounts[0]) {\n            const newAccount = createAccount({\n                address: (0,_utils_address_js__WEBPACK_IMPORTED_MODULE_7__.getAddress)(accounts[0]),\n                chain,\n                client,\n                provider,\n                sessionRequestHandler,\n                walletInfo,\n            });\n            emitter.emit(\"accountChanged\", newAccount);\n            emitter.emit(\"accountsChanged\", accounts);\n        }\n        else {\n            onDisconnect();\n        }\n    }\n    function onChainChanged(newChainId) {\n        const newChain = (0,_chains_utils_js__WEBPACK_IMPORTED_MODULE_2__.getCachedChain)((0,_utils_normalizeChainId_js__WEBPACK_IMPORTED_MODULE_4__.normalizeChainId)(newChainId));\n        emitter.emit(\"chainChanged\", newChain);\n        storage?.setItem(storageKeys.lastUsedChainId, String(newChainId));\n    }\n    provider.on(\"accountsChanged\", onAccountsChanged);\n    provider.on(\"chainChanged\", onChainChanged);\n    provider.on(\"disconnect\", onDisconnect);\n    provider.on(\"session_delete\", onDisconnect);\n    return [\n        account,\n        chain,\n        disconnect,\n        (newChain) => switchChainWC(provider, newChain),\n    ];\n}\nasync function switchChainWC(provider, chain) {\n    const chainId = chain.id;\n    try {\n        provider.setDefaultChain(`eip155:${chainId}`);\n    }\n    catch (error) {\n        const message = typeof error === \"string\" ? error : error?.message;\n        if (/user rejected request/i.test(message)) {\n            throw new viem__WEBPACK_IMPORTED_MODULE_11__.UserRejectedRequestError(error);\n        }\n        throw new viem__WEBPACK_IMPORTED_MODULE_11__.SwitchChainError(error);\n    }\n}\n/**\n * Set the requested chains to the storage.\n * @internal\n */\nfunction setRequestedChainsIds(chains, storage) {\n    storage?.setItem(storageKeys.requestedChains, (0,_utils_json_js__WEBPACK_IMPORTED_MODULE_12__.stringify)(chains));\n}\nfunction getChainsToRequest(options) {\n    const rpcMap = {};\n    const chainIds = [];\n    if (options.chain) {\n        rpcMap[options.chain.id] = (0,_chains_utils_js__WEBPACK_IMPORTED_MODULE_2__.getRpcUrlForChain)({\n            chain: options.chain,\n            client: options.client,\n        });\n        chainIds.push(options.chain.id);\n    }\n    // limit optional chains to 10\n    const optionalChains = (options?.optionalChains || []).slice(0, 10);\n    for (const chain of optionalChains) {\n        rpcMap[chain.id] = (0,_chains_utils_js__WEBPACK_IMPORTED_MODULE_2__.getRpcUrlForChain)({\n            chain: chain,\n            client: options.client,\n        });\n        chainIds.push(chain.id);\n    }\n    if (!options.chain && optionalChains.length === 0) {\n        rpcMap[1] = (0,_chains_utils_js__WEBPACK_IMPORTED_MODULE_2__.getCachedChain)(1).rpc;\n        chainIds.push(1);\n    }\n    return {\n        chains: chainIds.map((x) => `eip155:${x}`),\n        rpcMap,\n    };\n}\nconst chainsToRequestForSafe = [\n    1, // Ethereum Mainnet\n    11155111, // Sepolia Testnet\n    42161, // Arbitrum One Mainnet\n    43114, // Avalanche Mainnet\n    8453, // Base Mainnet\n    1313161554, // Aurora Mainnet\n    84532, // Base Sepolia Testnet\n    56, // Binance Smart Chain Mainnet\n    42220, // Celo Mainnet\n    100, // Gnosis Mainnet\n    10, // Optimism Mainnet\n    137, // Polygon Mainnet\n    1101, // Polygon zkEVM Mainnet\n    324, // zkSync Era mainnet\n    534352, // Scroll mainnet\n];\n//# sourceMappingURL=controller.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvdGhpcmR3ZWIvZGlzdC9lc20vd2FsbGV0cy93YWxsZXQtY29ubmVjdC9jb250cm9sbGVyLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBbUk7QUFDM0Q7QUFDRTtBQUN0QjtBQUNxQztBQUN6QztBQUNvQztBQUNpQztBQUN6RDtBQUNNO0FBQ007QUFDUjtBQUNEO0FBQy9EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQSxVQUFVLGVBQWU7QUFDekIsNkJBQTZCLDBFQUFhO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixxRUFBc0I7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9EQUFvRCw0REFBYztBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxrQ0FBa0M7QUFDOUM7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQixnQkFBZ0I7QUFDaEI7QUFDQSxhQUFhLG9EQUFTO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQSw0QkFBNEIsNEVBQWdCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBLEtBQUssWUFBWSxnQkFBZ0I7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxnRUFBYztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksMkZBQTBCO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QUMsNEVBQWdCO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMsUUFBUTtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQiwyREFBd0I7QUFDOUM7QUFDQSxrQkFBa0IsbURBQWdCO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELDBEQUFTO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsbUVBQWlCO0FBQ3BEO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixtRUFBaUI7QUFDNUM7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsZ0VBQWM7QUFDbEM7QUFDQTtBQUNBO0FBQ0EsOENBQThDLEVBQUU7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL25vZGVfbW9kdWxlcy90aGlyZHdlYi9kaXN0L2VzbS93YWxsZXRzL3dhbGxldC1jb25uZWN0L2NvbnRyb2xsZXIuanM/Yjg3ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRUeXBlc0ZvckVJUDcxMkRvbWFpbiwgU3dpdGNoQ2hhaW5FcnJvciwgc2VyaWFsaXplVHlwZWREYXRhLCBVc2VyUmVqZWN0ZWRSZXF1ZXN0RXJyb3IsIHZhbGlkYXRlVHlwZWREYXRhLCB9IGZyb20gXCJ2aWVtXCI7XG5pbXBvcnQgeyB0cmFja1RyYW5zYWN0aW9uIH0gZnJvbSBcIi4uLy4uL2FuYWx5dGljcy90cmFjay90cmFuc2FjdGlvbi5qc1wiO1xuaW1wb3J0IHsgZ2V0Q2FjaGVkQ2hhaW4sIGdldFJwY1VybEZvckNoYWluIH0gZnJvbSBcIi4uLy4uL2NoYWlucy91dGlscy5qc1wiO1xuaW1wb3J0IHsgZ2V0QWRkcmVzcyB9IGZyb20gXCIuLi8uLi91dGlscy9hZGRyZXNzLmpzXCI7XG5pbXBvcnQgeyBudW1iZXJUb0hleCwgc3RyaW5nVG9IZXgsIHVpbnQ4QXJyYXlUb0hleCwgfSBmcm9tIFwiLi4vLi4vdXRpbHMvZW5jb2RpbmcvaGV4LmpzXCI7XG5pbXBvcnQgeyBzdHJpbmdpZnkgfSBmcm9tIFwiLi4vLi4vdXRpbHMvanNvbi5qc1wiO1xuaW1wb3J0IHsgcGFyc2VUeXBlZERhdGEgfSBmcm9tIFwiLi4vLi4vdXRpbHMvc2lnbmF0dXJlcy9oZWxwZXJzL3BhcnNlLXR5cGVkLWRhdGEuanNcIjtcbmltcG9ydCB7IGdldFNhdmVkQ29ubmVjdFBhcmFtc0Zyb21TdG9yYWdlLCBzYXZlQ29ubmVjdFBhcmFtc1RvU3RvcmFnZSwgfSBmcm9tIFwiLi4vLi4vdXRpbHMvc3RvcmFnZS93YWxsZXRTdG9yYWdlLmpzXCI7XG5pbXBvcnQgeyBmb3JtYXRXYWxsZXRDb25uZWN0VXJsIH0gZnJvbSBcIi4uLy4uL3V0aWxzL3VybC5qc1wiO1xuaW1wb3J0IHsgZ2V0V2FsbGV0SW5mbyB9IGZyb20gXCIuLi9fX2dlbmVyYXRlZF9fL2dldFdhbGxldEluZm8uanNcIjtcbmltcG9ydCB7IGdldERlZmF1bHRBcHBNZXRhZGF0YSB9IGZyb20gXCIuLi91dGlscy9kZWZhdWx0RGFwcE1ldGFkYXRhLmpzXCI7XG5pbXBvcnQgeyBub3JtYWxpemVDaGFpbklkIH0gZnJvbSBcIi4uL3V0aWxzL25vcm1hbGl6ZUNoYWluSWQuanNcIjtcbmltcG9ydCB7IERFRkFVTFRfUFJPSkVDVF9JRCwgTkFNRVNQQUNFIH0gZnJvbSBcIi4vY29uc3RhbnRzLmpzXCI7XG5sZXQgY2FjaGVkUHJvdmlkZXIgPSBudWxsO1xuY29uc3Qgc3RvcmFnZUtleXMgPSB7XG4gICAgbGFzdFVzZWRDaGFpbklkOiBcInR3LndjLmxhc3RVc2VkQ2hhaW5JZFwiLFxuICAgIHJlcXVlc3RlZENoYWluczogXCJ0dy53Yy5yZXF1ZXN0ZWRDaGFpbnNcIixcbn07XG4vKipcbiAqIENoZWNrcyBpZiB0aGUgcHJvdmlkZWQgd2FsbGV0IGlzIGEgV2FsbGV0IENvbm5lY3Qgd2FsbGV0LlxuICpcbiAqIEBwYXJhbSB3YWxsZXQgLSBUaGUgd2FsbGV0IHRvIGNoZWNrLlxuICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgd2FsbGV0IGlzIGEgV2FsbGV0IENvbm5lY3Qgd2FsbGV0LCBmYWxzZSBvdGhlcndpc2UuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1dhbGxldENvbm5lY3Qod2FsbGV0KSB7XG4gICAgcmV0dXJuIHdhbGxldC5pZCA9PT0gXCJ3YWxsZXRDb25uZWN0XCI7XG59XG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29ubmVjdFdDKG9wdGlvbnMsIGVtaXR0ZXIsIHdhbGxldElkLCBzdG9yYWdlLCBzZXNzaW9uSGFuZGxlcikge1xuICAgIGNvbnN0IHByb3ZpZGVyID0gYXdhaXQgaW5pdFByb3ZpZGVyKG9wdGlvbnMsIHdhbGxldElkLCBzZXNzaW9uSGFuZGxlcik7XG4gICAgY29uc3Qgd2NPcHRpb25zID0gb3B0aW9ucy53YWxsZXRDb25uZWN0O1xuICAgIGxldCB7IG9uRGlzcGxheVVyaSB9ID0gd2NPcHRpb25zIHx8IHt9O1xuICAgIGNvbnN0IHdhbGxldEluZm8gPSBhd2FpdCBnZXRXYWxsZXRJbmZvKHdhbGxldElkKTtcbiAgICAvLyB1c2UgZGVmYXVsdCBzZXNzaW9uSGFuZGxlciB1bmxlc3Mgb25EaXNwbGF5VXJpIGlzIGV4cGxpY2l0bHkgcHJvdmlkZWRcbiAgICBpZiAoIW9uRGlzcGxheVVyaSAmJiBzZXNzaW9uSGFuZGxlcikge1xuICAgICAgICBjb25zdCBkZWVwbGlua0hhbmRsZXIgPSAodXJpKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhcHBVcmwgPSB3YWxsZXRJbmZvLm1vYmlsZS5uYXRpdmUgfHwgd2FsbGV0SW5mby5tb2JpbGUudW5pdmVyc2FsO1xuICAgICAgICAgICAgaWYgKCFhcHBVcmwpIHtcbiAgICAgICAgICAgICAgICAvLyBnZW5lcmljIHdjIHVyaVxuICAgICAgICAgICAgICAgIHNlc3Npb25IYW5kbGVyKHVyaSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZnVsbFVybCA9IGZvcm1hdFdhbGxldENvbm5lY3RVcmwoYXBwVXJsLCB1cmkpLnJlZGlyZWN0O1xuICAgICAgICAgICAgc2Vzc2lvbkhhbmRsZXIoZnVsbFVybCk7XG4gICAgICAgIH07XG4gICAgICAgIG9uRGlzcGxheVVyaSA9IGRlZXBsaW5rSGFuZGxlcjtcbiAgICB9XG4gICAgaWYgKG9uRGlzcGxheVVyaSkge1xuICAgICAgICBwcm92aWRlci5ldmVudHMuYWRkTGlzdGVuZXIoXCJkaXNwbGF5X3VyaVwiLCBvbkRpc3BsYXlVcmkpO1xuICAgIH1cbiAgICBsZXQgb3B0aW9uYWxDaGFpbnMgPSB3Y09wdGlvbnM/Lm9wdGlvbmFsQ2hhaW5zO1xuICAgIGxldCBjaGFpblRvUmVxdWVzdCA9IG9wdGlvbnMuY2hhaW47XG4gICAgLy8gaWdub3JlIHRoZSBnaXZlbiBvcHRpb25zIGNoYWlucyAtIGFuZCBzZXQgdGhlIHNhZmUgc3VwcG9ydGVkIGNoYWluc1xuICAgIGlmICh3YWxsZXRJZCA9PT0gXCJnbG9iYWwuc2FmZVwiKSB7XG4gICAgICAgIG9wdGlvbmFsQ2hhaW5zID0gY2hhaW5zVG9SZXF1ZXN0Rm9yU2FmZS5tYXAoZ2V0Q2FjaGVkQ2hhaW4pO1xuICAgICAgICBpZiAoY2hhaW5Ub1JlcXVlc3QgJiYgIW9wdGlvbmFsQ2hhaW5zLmluY2x1ZGVzKGNoYWluVG9SZXF1ZXN0KSkge1xuICAgICAgICAgICAgY2hhaW5Ub1JlcXVlc3QgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gRm9yIFVuaXZlcnNhbFByb3ZpZGVyLCB3ZSBzdGlsbCBuZWVkIGNoYWluIGNvbmZpZ3VyYXRpb24gZm9yIHNlc3Npb24gbWFuYWdlbWVudFxuICAgIGNvbnN0IHsgY2hhaW5zOiBjaGFpbnNUb1JlcXVlc3QsIHJwY01hcCB9ID0gZ2V0Q2hhaW5zVG9SZXF1ZXN0KHtcbiAgICAgICAgY2hhaW46IGNoYWluVG9SZXF1ZXN0LFxuICAgICAgICBjbGllbnQ6IG9wdGlvbnMuY2xpZW50LFxuICAgICAgICBvcHRpb25hbENoYWluczogb3B0aW9uYWxDaGFpbnMsXG4gICAgfSk7XG4gICAgLy8gRm9yIFVuaXZlcnNhbFByb3ZpZGVyLCB3ZSBuZWVkIHRvIGNvbm5lY3Qgd2l0aCBuYW1lc3BhY2VzXG4gICAgYXdhaXQgcHJvdmlkZXIuY29ubmVjdCh7XG4gICAgICAgIC4uLih3Y09wdGlvbnM/LnBhaXJpbmdUb3BpY1xuICAgICAgICAgICAgPyB7IHBhaXJpbmdUb3BpYzogd2NPcHRpb25zPy5wYWlyaW5nVG9waWMgfVxuICAgICAgICAgICAgOiB7fSksXG4gICAgICAgIG5hbWVzcGFjZXM6IHtcbiAgICAgICAgICAgIFtOQU1FU1BBQ0VdOiB7XG4gICAgICAgICAgICAgICAgY2hhaW5zOiBjaGFpbnNUb1JlcXVlc3QsXG4gICAgICAgICAgICAgICAgZXZlbnRzOiBbXCJjaGFpbkNoYW5nZWRcIiwgXCJhY2NvdW50c0NoYW5nZWRcIl0sXG4gICAgICAgICAgICAgICAgbWV0aG9kczogW1xuICAgICAgICAgICAgICAgICAgICBcImV0aF9zZW5kVHJhbnNhY3Rpb25cIixcbiAgICAgICAgICAgICAgICAgICAgXCJldGhfc2lnblRyYW5zYWN0aW9uXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZXRoX3NpZ25cIixcbiAgICAgICAgICAgICAgICAgICAgXCJwZXJzb25hbF9zaWduXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZXRoX3NpZ25UeXBlZERhdGFcIixcbiAgICAgICAgICAgICAgICAgICAgXCJ3YWxsZXRfc3dpdGNoRXRoZXJldW1DaGFpblwiLFxuICAgICAgICAgICAgICAgICAgICBcIndhbGxldF9hZGRFdGhlcmV1bUNoYWluXCIsXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBycGNNYXAsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIH0pO1xuICAgIHNldFJlcXVlc3RlZENoYWluc0lkcyhjaGFpbnNUb1JlcXVlc3QubWFwKCh4KSA9PiBOdW1iZXIoeC5zcGxpdChcIjpcIilbMV0pKSwgc3RvcmFnZSk7XG4gICAgY29uc3QgY3VycmVudENoYWluSWQgPSBjaGFpbnNUb1JlcXVlc3RbMF0/LnNwbGl0KFwiOlwiKVsxXSB8fCAxO1xuICAgIGNvbnN0IHByb3ZpZGVyQ2hhaW5JZCA9IG5vcm1hbGl6ZUNoYWluSWQoY3VycmVudENoYWluSWQpO1xuICAgIGNvbnN0IGFjY291bnRzID0gYXdhaXQgcHJvdmlkZXIucmVxdWVzdCh7XG4gICAgICAgIG1ldGhvZDogXCJldGhfcmVxdWVzdEFjY291bnRzXCIsXG4gICAgICAgIHBhcmFtczogW10sXG4gICAgfSwgYGVpcDE1NToke3Byb3ZpZGVyQ2hhaW5JZH1gKTtcbiAgICBjb25zdCBhZGRyZXNzID0gYWNjb3VudHNbMF07XG4gICAgaWYgKCFhZGRyZXNzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIGFjY291bnRzIGZvdW5kIG9uIHByb3ZpZGVyLlwiKTtcbiAgICB9XG4gICAgY29uc3QgY2hhaW4gPSBvcHRpb25zLmNoYWluICYmIG9wdGlvbnMuY2hhaW4uaWQgPT09IHByb3ZpZGVyQ2hhaW5JZFxuICAgICAgICA/IG9wdGlvbnMuY2hhaW5cbiAgICAgICAgOiBnZXRDYWNoZWRDaGFpbihwcm92aWRlckNoYWluSWQpO1xuICAgIGlmIChvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHNhdmVkUGFyYW1zID0ge1xuICAgICAgICAgICAgY2hhaW46IG9wdGlvbnMuY2hhaW4sXG4gICAgICAgICAgICBvcHRpb25hbENoYWluczogb3B0aW9ucy53YWxsZXRDb25uZWN0Py5vcHRpb25hbENoYWlucyxcbiAgICAgICAgICAgIHBhaXJpbmdUb3BpYzogb3B0aW9ucy53YWxsZXRDb25uZWN0Py5wYWlyaW5nVG9waWMsXG4gICAgICAgIH07XG4gICAgICAgIGlmIChzdG9yYWdlKSB7XG4gICAgICAgICAgICBzYXZlQ29ubmVjdFBhcmFtc1RvU3RvcmFnZShzdG9yYWdlLCB3YWxsZXRJZCwgc2F2ZWRQYXJhbXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICh3Y09wdGlvbnM/Lm9uRGlzcGxheVVyaSkge1xuICAgICAgICBwcm92aWRlci5ldmVudHMucmVtb3ZlTGlzdGVuZXIoXCJkaXNwbGF5X3VyaVwiLCB3Y09wdGlvbnMub25EaXNwbGF5VXJpKTtcbiAgICB9XG4gICAgcmV0dXJuIG9uQ29ubmVjdChhZGRyZXNzLCBjaGFpbiwgcHJvdmlkZXIsIGVtaXR0ZXIsIHN0b3JhZ2UsIG9wdGlvbnMuY2xpZW50LCB3YWxsZXRJbmZvLCBzZXNzaW9uSGFuZGxlcik7XG59XG4vKipcbiAqIEF1dG8gY29ubmVjdCB0byBhbHJlYWR5IGNvbm5lY3RlZCB3YWxsZXQgY29ubmVjdCBzZXNzaW9uLlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhdXRvQ29ubmVjdFdDKG9wdGlvbnMsIGVtaXR0ZXIsIHdhbGxldElkLCBzdG9yYWdlLCBzZXNzaW9uSGFuZGxlcikge1xuICAgIGNvbnN0IHNhdmVkQ29ubmVjdFBhcmFtcyA9IHN0b3JhZ2VcbiAgICAgICAgPyBhd2FpdCBnZXRTYXZlZENvbm5lY3RQYXJhbXNGcm9tU3RvcmFnZShzdG9yYWdlLCB3YWxsZXRJZClcbiAgICAgICAgOiBudWxsO1xuICAgIGNvbnN0IHdhbGxldEluZm8gPSBhd2FpdCBnZXRXYWxsZXRJbmZvKHdhbGxldElkKTtcbiAgICBjb25zdCBwcm92aWRlciA9IGF3YWl0IGluaXRQcm92aWRlcihzYXZlZENvbm5lY3RQYXJhbXNcbiAgICAgICAgPyB7XG4gICAgICAgICAgICBjaGFpbjogc2F2ZWRDb25uZWN0UGFyYW1zLmNoYWluLFxuICAgICAgICAgICAgY2xpZW50OiBvcHRpb25zLmNsaWVudCxcbiAgICAgICAgICAgIHdhbGxldENvbm5lY3Q6IHtcbiAgICAgICAgICAgICAgICBvcHRpb25hbENoYWluczogc2F2ZWRDb25uZWN0UGFyYW1zLm9wdGlvbmFsQ2hhaW5zLFxuICAgICAgICAgICAgICAgIHBhaXJpbmdUb3BpYzogc2F2ZWRDb25uZWN0UGFyYW1zLnBhaXJpbmdUb3BpYyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH1cbiAgICAgICAgOiB7XG4gICAgICAgICAgICBjbGllbnQ6IG9wdGlvbnMuY2xpZW50LFxuICAgICAgICAgICAgd2FsbGV0Q29ubmVjdDoge30sXG4gICAgICAgIH0sIHdhbGxldElkLCBzZXNzaW9uSGFuZGxlcik7XG4gICAgaWYgKCFwcm92aWRlci5zZXNzaW9uKSB7XG4gICAgICAgIGF3YWl0IHByb3ZpZGVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gd2FsbGV0IGNvbm5lY3Qgc2Vzc2lvbiBmb3VuZCBvbiBwcm92aWRlci5cIik7XG4gICAgfVxuICAgIC8vIEZvciBVbml2ZXJzYWxQcm92aWRlciwgZ2V0IGFjY291bnRzIGZyb20gZW5hYmxlKCkgbWV0aG9kXG4gICAgY29uc3QgbmFtZXNwYWNlQWNjb3VudHMgPSBwcm92aWRlci5zZXNzaW9uPy5uYW1lc3BhY2VzPy5bTkFNRVNQQUNFXT8uYWNjb3VudHM7XG4gICAgY29uc3QgYWRkcmVzcyA9IG5hbWVzcGFjZUFjY291bnRzPy5bMF0/LnNwbGl0KFwiOlwiKVsyXTtcbiAgICBpZiAoIWFkZHJlc3MpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gYWNjb3VudHMgZm91bmQgb24gcHJvdmlkZXIuXCIpO1xuICAgIH1cbiAgICAvLyBGb3IgVW5pdmVyc2FsUHJvdmlkZXIsIGdldCBjaGFpbklkIGZyb20gdGhlIHNlc3Npb24gbmFtZXNwYWNlcyBvciB1c2UgZGVmYXVsdFxuICAgIGNvbnN0IGN1cnJlbnRDaGFpbklkID0gb3B0aW9ucy5jaGFpbj8uaWQgfHwgMTtcbiAgICBjb25zdCBwcm92aWRlckNoYWluSWQgPSBub3JtYWxpemVDaGFpbklkKGN1cnJlbnRDaGFpbklkKTtcbiAgICBjb25zdCBjaGFpbiA9IG9wdGlvbnMuY2hhaW4gJiYgb3B0aW9ucy5jaGFpbi5pZCA9PT0gcHJvdmlkZXJDaGFpbklkXG4gICAgICAgID8gb3B0aW9ucy5jaGFpblxuICAgICAgICA6IGdldENhY2hlZENoYWluKHByb3ZpZGVyQ2hhaW5JZCk7XG4gICAgcmV0dXJuIG9uQ29ubmVjdChhZGRyZXNzLCBjaGFpbiwgcHJvdmlkZXIsIGVtaXR0ZXIsIHN0b3JhZ2UsIG9wdGlvbnMuY2xpZW50LCB3YWxsZXRJbmZvLCBzZXNzaW9uSGFuZGxlcik7XG59XG4vLyBDb25uZWN0aW9uIHV0aWxzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5hc3luYyBmdW5jdGlvbiBpbml0UHJvdmlkZXIob3B0aW9ucywgd2FsbGV0SWQsIHNlc3Npb25SZXF1ZXN0SGFuZGxlcikge1xuICAgIGlmIChjYWNoZWRQcm92aWRlcikge1xuICAgICAgICByZXR1cm4gY2FjaGVkUHJvdmlkZXI7XG4gICAgfVxuICAgIGNvbnN0IHdhbGxldEluZm8gPSBhd2FpdCBnZXRXYWxsZXRJbmZvKHdhbGxldElkKTtcbiAgICBjb25zdCB3Y09wdGlvbnMgPSBvcHRpb25zLndhbGxldENvbm5lY3Q7XG4gICAgY29uc3QgeyBVbml2ZXJzYWxQcm92aWRlciB9ID0gYXdhaXQgaW1wb3J0KFwiQHdhbGxldGNvbm5lY3QvdW5pdmVyc2FsLXByb3ZpZGVyXCIpO1xuICAgIGxldCBvcHRpb25hbENoYWlucyA9IHdjT3B0aW9ucz8ub3B0aW9uYWxDaGFpbnM7XG4gICAgbGV0IGNoYWluVG9SZXF1ZXN0ID0gb3B0aW9ucy5jaGFpbjtcbiAgICAvLyBpZ25vcmUgdGhlIGdpdmVuIG9wdGlvbnMgY2hhaW5zIC0gYW5kIHNldCB0aGUgc2FmZSBzdXBwb3J0ZWQgY2hhaW5zXG4gICAgaWYgKHdhbGxldElkID09PSBcImdsb2JhbC5zYWZlXCIpIHtcbiAgICAgICAgb3B0aW9uYWxDaGFpbnMgPSBjaGFpbnNUb1JlcXVlc3RGb3JTYWZlLm1hcChnZXRDYWNoZWRDaGFpbik7XG4gICAgICAgIGlmIChjaGFpblRvUmVxdWVzdCAmJiAhb3B0aW9uYWxDaGFpbnMuaW5jbHVkZXMoY2hhaW5Ub1JlcXVlc3QpKSB7XG4gICAgICAgICAgICBjaGFpblRvUmVxdWVzdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBwcm92aWRlciA9IGF3YWl0IFVuaXZlcnNhbFByb3ZpZGVyLmluaXQoe1xuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IHdjT3B0aW9ucz8uYXBwTWV0YWRhdGE/LmRlc2NyaXB0aW9uIHx8XG4gICAgICAgICAgICAgICAgZ2V0RGVmYXVsdEFwcE1ldGFkYXRhKCkuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICBpY29uczogW1xuICAgICAgICAgICAgICAgIHdjT3B0aW9ucz8uYXBwTWV0YWRhdGE/LmxvZ29VcmwgfHwgZ2V0RGVmYXVsdEFwcE1ldGFkYXRhKCkubG9nb1VybCxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBuYW1lOiB3Y09wdGlvbnM/LmFwcE1ldGFkYXRhPy5uYW1lIHx8IGdldERlZmF1bHRBcHBNZXRhZGF0YSgpLm5hbWUsXG4gICAgICAgICAgICB1cmw6IHdjT3B0aW9ucz8uYXBwTWV0YWRhdGE/LnVybCB8fCBnZXREZWZhdWx0QXBwTWV0YWRhdGEoKS51cmwsXG4gICAgICAgICAgICByZWRpcmVjdDoge1xuICAgICAgICAgICAgICAgIG5hdGl2ZTogd2FsbGV0SW5mby5tb2JpbGUubmF0aXZlIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bml2ZXJzYWw6IHdhbGxldEluZm8ubW9iaWxlLnVuaXZlcnNhbCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBwcm9qZWN0SWQ6IHdjT3B0aW9ucz8ucHJvamVjdElkIHx8IERFRkFVTFRfUFJPSkVDVF9JRCxcbiAgICB9KTtcbiAgICBwcm92aWRlci5ldmVudHMuc2V0TWF4TGlzdGVuZXJzKE51bWJlci5QT1NJVElWRV9JTkZJTklUWSk7XG4gICAgaWYgKHdhbGxldElkICE9PSBcIndhbGxldENvbm5lY3RcIikge1xuICAgICAgICBhc3luYyBmdW5jdGlvbiBoYW5kbGVTZXNzaW9uUmVxdWVzdCgpIHtcbiAgICAgICAgICAgIGNvbnN0IHdhbGxldExpbmtUb09wZW4gPSBwcm92aWRlci5zZXNzaW9uPy5wZWVyPy5tZXRhZGF0YT8ucmVkaXJlY3Q/Lm5hdGl2ZSB8fFxuICAgICAgICAgICAgICAgIHdhbGxldEluZm8ubW9iaWxlLm5hdGl2ZSB8fFxuICAgICAgICAgICAgICAgIHdhbGxldEluZm8ubW9iaWxlLnVuaXZlcnNhbDtcbiAgICAgICAgICAgIGlmIChzZXNzaW9uUmVxdWVzdEhhbmRsZXIgJiYgd2FsbGV0TGlua1RvT3Blbikge1xuICAgICAgICAgICAgICAgIC8vIFRPRE86IHByb3BhZ2F0ZSBlcnJvciB3aGVuIHRoaXMgZmFpbHNcbiAgICAgICAgICAgICAgICBhd2FpdCBzZXNzaW9uUmVxdWVzdEhhbmRsZXIod2FsbGV0TGlua1RvT3Blbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gRm9yIFVuaXZlcnNhbFByb3ZpZGVyLCB1c2UgZGlmZmVyZW50IGV2ZW50IGhhbmRsaW5nXG4gICAgICAgIHByb3ZpZGVyLm9uKFwic2Vzc2lvbl9yZXF1ZXN0X3NlbnRcIiwgaGFuZGxlU2Vzc2lvblJlcXVlc3QpO1xuICAgICAgICBwcm92aWRlci5ldmVudHMuYWRkTGlzdGVuZXIoXCJkaXNjb25uZWN0XCIsICgpID0+IHtcbiAgICAgICAgICAgIHByb3ZpZGVyLm9mZihcInNlc3Npb25fcmVxdWVzdF9zZW50XCIsIGhhbmRsZVNlc3Npb25SZXF1ZXN0KTtcbiAgICAgICAgICAgIGNhY2hlZFByb3ZpZGVyID0gbnVsbDtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNhY2hlZFByb3ZpZGVyID0gcHJvdmlkZXI7XG4gICAgcmV0dXJuIHByb3ZpZGVyO1xufVxuZnVuY3Rpb24gY3JlYXRlQWNjb3VudCh7IHByb3ZpZGVyLCBhZGRyZXNzLCBjbGllbnQsIGNoYWluLCBzZXNzaW9uUmVxdWVzdEhhbmRsZXIsIHdhbGxldEluZm8sIH0pIHtcbiAgICBjb25zdCBhY2NvdW50ID0ge1xuICAgICAgICBhZGRyZXNzOiBnZXRBZGRyZXNzKGFkZHJlc3MpLFxuICAgICAgICBhc3luYyBzZW5kVHJhbnNhY3Rpb24odHgpIHtcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uSGFzaCA9IChhd2FpdCByZXF1ZXN0QW5kT3BlbldhbGxldCh7XG4gICAgICAgICAgICAgICAgcHJvdmlkZXIsXG4gICAgICAgICAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiZXRoX3NlbmRUcmFuc2FjdGlvblwiLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB0eC5kYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb206IGdldEFkZHJlc3MoYWRkcmVzcyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FzOiB0eC5nYXMgPyBudW1iZXJUb0hleCh0eC5nYXMpIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvOiB0eC50byxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdHgudmFsdWUgPyBudW1iZXJUb0hleCh0eC52YWx1ZSkgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY2hhaW46IGBlaXAxNTU6JHt0eC5jaGFpbklkfWAsXG4gICAgICAgICAgICAgICAgd2FsbGV0SW5mbyxcbiAgICAgICAgICAgICAgICBzZXNzaW9uUmVxdWVzdEhhbmRsZXIsXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB0cmFja1RyYW5zYWN0aW9uKHtcbiAgICAgICAgICAgICAgICBjaGFpbklkOiB0eC5jaGFpbklkLFxuICAgICAgICAgICAgICAgIGNsaWVudDogY2xpZW50LFxuICAgICAgICAgICAgICAgIGNvbnRyYWN0QWRkcmVzczogdHgudG8gPz8gdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIGdhc1ByaWNlOiB0eC5nYXNQcmljZSxcbiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkhhc2gsXG4gICAgICAgICAgICAgICAgd2FsbGV0QWRkcmVzczogZ2V0QWRkcmVzcyhhZGRyZXNzKSxcbiAgICAgICAgICAgICAgICB3YWxsZXRUeXBlOiBcIndhbGxldENvbm5lY3RcIixcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkhhc2gsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuICAgICAgICBhc3luYyBzaWduTWVzc2FnZSh7IG1lc3NhZ2UgfSkge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZVRvU2lnbiA9ICgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdHJpbmdUb0hleChtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucmF3IGluc3RhbmNlb2YgVWludDhBcnJheSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdWludDhBcnJheVRvSGV4KG1lc3NhZ2UucmF3KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2UucmF3O1xuICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0QW5kT3BlbldhbGxldCh7XG4gICAgICAgICAgICAgICAgcHJvdmlkZXIsXG4gICAgICAgICAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwicGVyc29uYWxfc2lnblwiLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IFttZXNzYWdlVG9TaWduLCB0aGlzLmFkZHJlc3NdLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY2hhaW46IGBlaXAxNTU6JHtjaGFpbi5pZH1gLFxuICAgICAgICAgICAgICAgIHdhbGxldEluZm8sXG4gICAgICAgICAgICAgICAgc2Vzc2lvblJlcXVlc3RIYW5kbGVyLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGFzeW5jIHNpZ25UeXBlZERhdGEoX2RhdGEpIHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBwYXJzZVR5cGVkRGF0YShfZGF0YSk7XG4gICAgICAgICAgICBjb25zdCB7IGRvbWFpbiwgbWVzc2FnZSwgcHJpbWFyeVR5cGUgfSA9IGRhdGE7XG4gICAgICAgICAgICBjb25zdCB0eXBlcyA9IHtcbiAgICAgICAgICAgICAgICBFSVA3MTJEb21haW46IGdldFR5cGVzRm9yRUlQNzEyRG9tYWluKHsgZG9tYWluIH0pLFxuICAgICAgICAgICAgICAgIC4uLmRhdGEudHlwZXMsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLy8gTmVlZCB0byBkbyBhIHJ1bnRpbWUgdmFsaWRhdGlvbiBjaGVjayBvbiBhZGRyZXNzZXMsIGJ5dGUgcmFuZ2VzLCBpbnRlZ2VyIHJhbmdlcywgZXRjXG4gICAgICAgICAgICAvLyBhcyB3ZSBjYW4ndCBzdGF0aWNhbGx5IGNoZWNrIHRoaXMgd2l0aCBUeXBlU2NyaXB0LlxuICAgICAgICAgICAgdmFsaWRhdGVUeXBlZERhdGEoeyBkb21haW4sIG1lc3NhZ2UsIHByaW1hcnlUeXBlLCB0eXBlcyB9KTtcbiAgICAgICAgICAgIGNvbnN0IHR5cGVkRGF0YSA9IHNlcmlhbGl6ZVR5cGVkRGF0YSh7XG4gICAgICAgICAgICAgICAgZG9tYWluOiBkb21haW4gPz8ge30sXG4gICAgICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgICAgICBwcmltYXJ5VHlwZSxcbiAgICAgICAgICAgICAgICB0eXBlcyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJlcXVlc3RBbmRPcGVuV2FsbGV0KHtcbiAgICAgICAgICAgICAgICBwcm92aWRlcixcbiAgICAgICAgICAgICAgICBwYXlsb2FkOiB7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJldGhfc2lnblR5cGVkRGF0YV92NFwiLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IFt0aGlzLmFkZHJlc3MsIHR5cGVkRGF0YV0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjaGFpbjogYGVpcDE1NToke2NoYWluLmlkfWAsXG4gICAgICAgICAgICAgICAgd2FsbGV0SW5mbyxcbiAgICAgICAgICAgICAgICBzZXNzaW9uUmVxdWVzdEhhbmRsZXIsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICB9O1xuICAgIHJldHVybiBhY2NvdW50O1xufVxuYXN5bmMgZnVuY3Rpb24gcmVxdWVzdEFuZE9wZW5XYWxsZXQoYXJncykge1xuICAgIGNvbnN0IHsgcHJvdmlkZXIsIHBheWxvYWQsIGNoYWluLCB3YWxsZXRJbmZvLCBzZXNzaW9uUmVxdWVzdEhhbmRsZXIgfSA9IGFyZ3M7XG4gICAgY29uc3QgcmVzdWx0UHJvbWlzZSA9IHByb3ZpZGVyLnJlcXVlc3QocGF5bG9hZCwgY2hhaW4pO1xuICAgIGNvbnN0IHdhbGxldExpbmtUb09wZW4gPSBwcm92aWRlci5zZXNzaW9uPy5wZWVyPy5tZXRhZGF0YT8ucmVkaXJlY3Q/Lm5hdGl2ZSB8fFxuICAgICAgICB3YWxsZXRJbmZvLm1vYmlsZS5uYXRpdmUgfHxcbiAgICAgICAgd2FsbGV0SW5mby5tb2JpbGUudW5pdmVyc2FsO1xuICAgIGlmIChzZXNzaW9uUmVxdWVzdEhhbmRsZXIgJiYgd2FsbGV0TGlua1RvT3Blbikge1xuICAgICAgICBhd2FpdCBzZXNzaW9uUmVxdWVzdEhhbmRsZXIod2FsbGV0TGlua1RvT3Blbik7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRQcm9taXNlO1xufVxuZnVuY3Rpb24gb25Db25uZWN0KGFkZHJlc3MsIGNoYWluLCBwcm92aWRlciwgZW1pdHRlciwgc3RvcmFnZSwgY2xpZW50LCB3YWxsZXRJbmZvLCBzZXNzaW9uUmVxdWVzdEhhbmRsZXIpIHtcbiAgICBjb25zdCBhY2NvdW50ID0gY3JlYXRlQWNjb3VudCh7XG4gICAgICAgIGFkZHJlc3MsXG4gICAgICAgIGNoYWluLFxuICAgICAgICBjbGllbnQsXG4gICAgICAgIHByb3ZpZGVyLFxuICAgICAgICBzZXNzaW9uUmVxdWVzdEhhbmRsZXIsXG4gICAgICAgIHdhbGxldEluZm8sXG4gICAgfSk7XG4gICAgYXN5bmMgZnVuY3Rpb24gZGlzY29ubmVjdCgpIHtcbiAgICAgICAgcHJvdmlkZXIucmVtb3ZlTGlzdGVuZXIoXCJhY2NvdW50c0NoYW5nZWRcIiwgb25BY2NvdW50c0NoYW5nZWQpO1xuICAgICAgICBwcm92aWRlci5yZW1vdmVMaXN0ZW5lcihcImNoYWluQ2hhbmdlZFwiLCBvbkNoYWluQ2hhbmdlZCk7XG4gICAgICAgIHByb3ZpZGVyLnJlbW92ZUxpc3RlbmVyKFwiZGlzY29ubmVjdFwiLCBvbkRpc2Nvbm5lY3QpO1xuICAgICAgICBhd2FpdCBwcm92aWRlci5kaXNjb25uZWN0KCk7XG4gICAgICAgIGNhY2hlZFByb3ZpZGVyID0gbnVsbDtcbiAgICB9XG4gICAgZnVuY3Rpb24gb25EaXNjb25uZWN0KCkge1xuICAgICAgICBzZXRSZXF1ZXN0ZWRDaGFpbnNJZHMoW10sIHN0b3JhZ2UpO1xuICAgICAgICBzdG9yYWdlPy5yZW1vdmVJdGVtKHN0b3JhZ2VLZXlzLmxhc3RVc2VkQ2hhaW5JZCk7XG4gICAgICAgIGRpc2Nvbm5lY3QoKTtcbiAgICAgICAgZW1pdHRlci5lbWl0KFwiZGlzY29ubmVjdFwiLCB1bmRlZmluZWQpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBvbkFjY291bnRzQ2hhbmdlZChhY2NvdW50cykge1xuICAgICAgICBpZiAoYWNjb3VudHNbMF0pIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0FjY291bnQgPSBjcmVhdGVBY2NvdW50KHtcbiAgICAgICAgICAgICAgICBhZGRyZXNzOiBnZXRBZGRyZXNzKGFjY291bnRzWzBdKSxcbiAgICAgICAgICAgICAgICBjaGFpbixcbiAgICAgICAgICAgICAgICBjbGllbnQsXG4gICAgICAgICAgICAgICAgcHJvdmlkZXIsXG4gICAgICAgICAgICAgICAgc2Vzc2lvblJlcXVlc3RIYW5kbGVyLFxuICAgICAgICAgICAgICAgIHdhbGxldEluZm8sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGVtaXR0ZXIuZW1pdChcImFjY291bnRDaGFuZ2VkXCIsIG5ld0FjY291bnQpO1xuICAgICAgICAgICAgZW1pdHRlci5lbWl0KFwiYWNjb3VudHNDaGFuZ2VkXCIsIGFjY291bnRzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG9uRGlzY29ubmVjdCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uQ2hhaW5DaGFuZ2VkKG5ld0NoYWluSWQpIHtcbiAgICAgICAgY29uc3QgbmV3Q2hhaW4gPSBnZXRDYWNoZWRDaGFpbihub3JtYWxpemVDaGFpbklkKG5ld0NoYWluSWQpKTtcbiAgICAgICAgZW1pdHRlci5lbWl0KFwiY2hhaW5DaGFuZ2VkXCIsIG5ld0NoYWluKTtcbiAgICAgICAgc3RvcmFnZT8uc2V0SXRlbShzdG9yYWdlS2V5cy5sYXN0VXNlZENoYWluSWQsIFN0cmluZyhuZXdDaGFpbklkKSk7XG4gICAgfVxuICAgIHByb3ZpZGVyLm9uKFwiYWNjb3VudHNDaGFuZ2VkXCIsIG9uQWNjb3VudHNDaGFuZ2VkKTtcbiAgICBwcm92aWRlci5vbihcImNoYWluQ2hhbmdlZFwiLCBvbkNoYWluQ2hhbmdlZCk7XG4gICAgcHJvdmlkZXIub24oXCJkaXNjb25uZWN0XCIsIG9uRGlzY29ubmVjdCk7XG4gICAgcHJvdmlkZXIub24oXCJzZXNzaW9uX2RlbGV0ZVwiLCBvbkRpc2Nvbm5lY3QpO1xuICAgIHJldHVybiBbXG4gICAgICAgIGFjY291bnQsXG4gICAgICAgIGNoYWluLFxuICAgICAgICBkaXNjb25uZWN0LFxuICAgICAgICAobmV3Q2hhaW4pID0+IHN3aXRjaENoYWluV0MocHJvdmlkZXIsIG5ld0NoYWluKSxcbiAgICBdO1xufVxuYXN5bmMgZnVuY3Rpb24gc3dpdGNoQ2hhaW5XQyhwcm92aWRlciwgY2hhaW4pIHtcbiAgICBjb25zdCBjaGFpbklkID0gY2hhaW4uaWQ7XG4gICAgdHJ5IHtcbiAgICAgICAgcHJvdmlkZXIuc2V0RGVmYXVsdENoYWluKGBlaXAxNTU6JHtjaGFpbklkfWApO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHR5cGVvZiBlcnJvciA9PT0gXCJzdHJpbmdcIiA/IGVycm9yIDogZXJyb3I/Lm1lc3NhZ2U7XG4gICAgICAgIGlmICgvdXNlciByZWplY3RlZCByZXF1ZXN0L2kudGVzdChtZXNzYWdlKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJSZWplY3RlZFJlcXVlc3RFcnJvcihlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IFN3aXRjaENoYWluRXJyb3IoZXJyb3IpO1xuICAgIH1cbn1cbi8qKlxuICogU2V0IHRoZSByZXF1ZXN0ZWQgY2hhaW5zIHRvIHRoZSBzdG9yYWdlLlxuICogQGludGVybmFsXG4gKi9cbmZ1bmN0aW9uIHNldFJlcXVlc3RlZENoYWluc0lkcyhjaGFpbnMsIHN0b3JhZ2UpIHtcbiAgICBzdG9yYWdlPy5zZXRJdGVtKHN0b3JhZ2VLZXlzLnJlcXVlc3RlZENoYWlucywgc3RyaW5naWZ5KGNoYWlucykpO1xufVxuZnVuY3Rpb24gZ2V0Q2hhaW5zVG9SZXF1ZXN0KG9wdGlvbnMpIHtcbiAgICBjb25zdCBycGNNYXAgPSB7fTtcbiAgICBjb25zdCBjaGFpbklkcyA9IFtdO1xuICAgIGlmIChvcHRpb25zLmNoYWluKSB7XG4gICAgICAgIHJwY01hcFtvcHRpb25zLmNoYWluLmlkXSA9IGdldFJwY1VybEZvckNoYWluKHtcbiAgICAgICAgICAgIGNoYWluOiBvcHRpb25zLmNoYWluLFxuICAgICAgICAgICAgY2xpZW50OiBvcHRpb25zLmNsaWVudCxcbiAgICAgICAgfSk7XG4gICAgICAgIGNoYWluSWRzLnB1c2gob3B0aW9ucy5jaGFpbi5pZCk7XG4gICAgfVxuICAgIC8vIGxpbWl0IG9wdGlvbmFsIGNoYWlucyB0byAxMFxuICAgIGNvbnN0IG9wdGlvbmFsQ2hhaW5zID0gKG9wdGlvbnM/Lm9wdGlvbmFsQ2hhaW5zIHx8IFtdKS5zbGljZSgwLCAxMCk7XG4gICAgZm9yIChjb25zdCBjaGFpbiBvZiBvcHRpb25hbENoYWlucykge1xuICAgICAgICBycGNNYXBbY2hhaW4uaWRdID0gZ2V0UnBjVXJsRm9yQ2hhaW4oe1xuICAgICAgICAgICAgY2hhaW46IGNoYWluLFxuICAgICAgICAgICAgY2xpZW50OiBvcHRpb25zLmNsaWVudCxcbiAgICAgICAgfSk7XG4gICAgICAgIGNoYWluSWRzLnB1c2goY2hhaW4uaWQpO1xuICAgIH1cbiAgICBpZiAoIW9wdGlvbnMuY2hhaW4gJiYgb3B0aW9uYWxDaGFpbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJwY01hcFsxXSA9IGdldENhY2hlZENoYWluKDEpLnJwYztcbiAgICAgICAgY2hhaW5JZHMucHVzaCgxKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgY2hhaW5zOiBjaGFpbklkcy5tYXAoKHgpID0+IGBlaXAxNTU6JHt4fWApLFxuICAgICAgICBycGNNYXAsXG4gICAgfTtcbn1cbmNvbnN0IGNoYWluc1RvUmVxdWVzdEZvclNhZmUgPSBbXG4gICAgMSwgLy8gRXRoZXJldW0gTWFpbm5ldFxuICAgIDExMTU1MTExLCAvLyBTZXBvbGlhIFRlc3RuZXRcbiAgICA0MjE2MSwgLy8gQXJiaXRydW0gT25lIE1haW5uZXRcbiAgICA0MzExNCwgLy8gQXZhbGFuY2hlIE1haW5uZXRcbiAgICA4NDUzLCAvLyBCYXNlIE1haW5uZXRcbiAgICAxMzEzMTYxNTU0LCAvLyBBdXJvcmEgTWFpbm5ldFxuICAgIDg0NTMyLCAvLyBCYXNlIFNlcG9saWEgVGVzdG5ldFxuICAgIDU2LCAvLyBCaW5hbmNlIFNtYXJ0IENoYWluIE1haW5uZXRcbiAgICA0MjIyMCwgLy8gQ2VsbyBNYWlubmV0XG4gICAgMTAwLCAvLyBHbm9zaXMgTWFpbm5ldFxuICAgIDEwLCAvLyBPcHRpbWlzbSBNYWlubmV0XG4gICAgMTM3LCAvLyBQb2x5Z29uIE1haW5uZXRcbiAgICAxMTAxLCAvLyBQb2x5Z29uIHprRVZNIE1haW5uZXRcbiAgICAzMjQsIC8vIHprU3luYyBFcmEgbWFpbm5ldFxuICAgIDUzNDM1MiwgLy8gU2Nyb2xsIG1haW5uZXRcbl07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb250cm9sbGVyLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./node_modules/thirdweb/dist/esm/wallets/wallet-connect/controller.js\n"));

/***/ })

}]);